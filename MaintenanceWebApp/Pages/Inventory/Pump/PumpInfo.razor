@page "/PumpInfo/{PumpId}"

@using MaintenanceWebApp.Data
@using Microsoft.EntityFrameworkCore
@inject DataContext DataContext
@inject Microsoft.AspNetCore.Components.NavigationManager NavigationManager		
@inject IConfiguration Configuration

<div class="card">

	@if (pump != null){
		<div class="card-header bg-light border-primary">
			Pump Information
		</div>
		<div class="card-body">
			<div class="form-group row">

				<div class="col-sm-5">

					@if (string.IsNullOrWhiteSpace(pump.Photo) == false)
					{
						<img style="align-content:center;" width="100%" src="@CreateWebPath(pump.Photo)" alt="Pump Photo">
					}

				</div>

				<div class="col-sm-7">
					<h5 class="display-6">@pump.Name</h5><hr />
					<table width="100%">
						<tr>
							<td class="td-first">Location</td>
							<td> : </td>
							<td class="td-last">@pump.Location</td>
						</tr>
						<tr>
							<td class="td-first">Material</td>
							<td> : </td>
							<td class="td-last">@pump.Material</td>
						</tr>
						<tr>
							<td class="td-first">Brand</td>
							<td> : </td>
							<td class="td-last">@pump.Brand</td>
						</tr>
						<tr>
							<td class="td-first">Type</td>
							<td> : </td>
							<td class="td-last">@pump.Type</td>
						</tr>
						<tr>
							<td class="td-first">Tank</td>
							<td> : </td>
							@if (tank != null){
								<td class="td-last">@tank.TankNo</td>
							}
							else
							{
								<td></td>
							}
						</tr>
						<tr>
							<td class="td-first">Pump Tag</td>
							<td> : </td>
							<td class="td-last">@pump.PumpTag</td>
						</tr>
						<tr>
							<td class="td-first">Year</td>
							<td> : </td>
							<td class="td-last">@pump.Year</td>
						</tr>
						<tr>
							<td class="td-first">Explotion Proof Code</td>
							<td> : </td>
							<td class="td-last">@pump.ExplotionProofCode</td>
						</tr>
						<tr>
							<td class="td-first">Pump Capacity</td>
							<td> : </td>
							<td class="td-last">@pump.PumpCapacity</td>
						</tr>
						<tr>
							<td class="td-first">Power</td>
							<td> : </td>
							<td class="td-last">@pump.Power</td>
						</tr>
					</table>
				</div>

			</div>

			<div class="row">
				<div class="col-sm-12 px-3 py-2">
					<p><b>Description</b></p><hr/>
					<p class="px-1">@pump.Description</p>
				</div>
			</div>

		</div>
	}
	else
	{
		<p>Loading pump information...</p>
	}
</div>

@code {
	private Pump pump;
	private Tank tank;
	[Parameter]
	public string PumpId { get; set; }

	//private List<Tank> Tanks { get; set; } = new List<Tank>();

	private async Task LoadData()
	{
		//Tanks = await DataContext.Tanks.ToListAsync();
		tank = await DataContext.Tanks.FindAsync(pump.TankId);
	}

	private string CreateWebPath(string relativePath)
	{
		return Path.Combine(Configuration.GetValue<string>("WebStorageRoot")!, relativePath);
	}

    protected override async Task OnInitializedAsync()
	{
    
        pump = await DataContext.Pumps.FindAsync(PumpId);
        await LoadData();

		if (pump == null)
        {
            NavigationManager.NavigateTo("/PumpList", forceLoad: true);
        }
    }
}
